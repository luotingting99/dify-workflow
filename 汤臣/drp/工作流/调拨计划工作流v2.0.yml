app:
  description: ''
  icon: ğŸ¤–
  icon_background: '#FFEAD5'
  mode: workflow
  name: è°ƒæ‹¨è®¡åˆ’å·¥ä½œæµv2.0
  use_icon_as_answer_icon: false
dependencies: []
kind: app
version: 0.4.0
workflow:
  conversation_variables: []
  environment_variables: []
  features:
    file_upload:
      allowed_file_extensions:
      - .JPG
      - .JPEG
      - .PNG
      - .GIF
      - .WEBP
      - .SVG
      allowed_file_types:
      - image
      allowed_file_upload_methods:
      - local_file
      - remote_url
      enabled: false
      fileUploadConfig:
        audio_file_size_limit: 50
        batch_count_limit: 5
        file_size_limit: 15
        image_file_size_limit: 10
        video_file_size_limit: 100
        workflow_file_upload_limit: 10
      image:
        enabled: false
        number_limits: 3
        transfer_methods:
        - local_file
        - remote_url
      number_limits: 3
    opening_statement: ''
    retriever_resource:
      enabled: true
    sensitive_word_avoidance:
      enabled: false
    speech_to_text:
      enabled: false
    suggested_questions: []
    suggested_questions_after_answer:
      enabled: false
    text_to_speech:
      enabled: false
      language: ''
      voice: ''
  graph:
    edges:
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: start
        targetType: agent
      id: 1761221121698-source-1761221127988-target
      source: '1761221121698'
      sourceHandle: source
      target: '1761221127988'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: agent
        targetType: code
      id: 1761221127988-source-1761221130000-target
      source: '1761221127988'
      sourceHandle: source
      target: '1761221130000'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: code
        targetType: end
      id: 1761221130000-source-1761221135331-target
      source: '1761221130000'
      sourceHandle: source
      target: '1761221135331'
      targetHandle: target
      type: custom
      zIndex: 0
    nodes:
    - data:
        desc: ''
        selected: false
        title: å¼€å§‹
        type: start
        variables:
        - label: query
          max_length: 1024
          options: []
          required: true
          type: paragraph
          variable: query
        - default: ''
          hint: ''
          label: intent
          max_length: 256
          options: []
          placeholder: ''
          required: true
          type: text-input
          variable: intent
        - default: ''
          hint: ''
          label: time_window
          max_length: 256
          options: []
          placeholder: ''
          required: true
          type: text-input
          variable: time_window
        - default: ''
          hint: ''
          label: SKU
          max_length: 256
          options: []
          placeholder: ''
          required: false
          type: text-input
          variable: SKU
        - default: ''
          hint: ''
          label: warehouse_in_physical_name
          max_length: 48
          options: []
          placeholder: ''
          required: false
          type: text-input
          variable: warehouse_in_physical_name
      height: 192
      id: '1761221121698'
      position:
        x: 80
        y: 282
      positionAbsolute:
        x: 80
        y: 282
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        agent_parameters:
          instruction:
            type: constant
            value: "ã€æ‰§è¡Œç­–ç•¥ - å¼ºåˆ¶éµå®ˆã€‘\nå¿…é¡»ä¸¥æ ¼æŒ‰é¡ºåºæ‰§è¡Œ3æ­¥å·¥å…·è°ƒç”¨ï¼Œç¦æ­¢è·³è¿‡ä»»ä½•æ­¥éª¤ï¼š\nç¬¬1æ­¥ï¼šæ±‡æ€»KPIæŸ¥è¯¢ - å¿…é¡»æ‰§è¡Œ\n\
              ç¬¬2æ­¥ï¼šæŒ‰ä»“åˆ†ç»„æŸ¥è¯¢ - å¿…é¡»æ‰§è¡Œ\nç¬¬3æ­¥ï¼šCSVå¯¼å‡ºï¼ˆexport_oss=trueï¼‰ - å¿…é¡»æ‰§è¡Œ\nç¬¬3æ­¥å®Œæˆåï¼Œç«‹å³è‡ªåŠ¨ç»“æŸï¼Œä¸è¾“å‡ºFinal\
              \ Answerã€‚\n\nã€ç¦æ­¢è¡Œä¸º - ä¸¥æ ¼æ‰§è¡Œã€‘\nâŒ ç¦æ­¢è·³è¿‡ä»»ä½•æ­¥éª¤\nâŒ ä¸¥ç¦è¾“å‡ºFinal Answerï¼ˆä»»ä½•æƒ…å†µä¸‹éƒ½ä¸å…è®¸ï¼ŒCodeèŠ‚ç‚¹ä¼šè‡ªåŠ¨å¤„ç†æ•°æ®ï¼‰\n\
              âŒ ç¦æ­¢è¾“å‡ºSQLæˆ–è§£é‡Š\nâŒ ç¦æ­¢è¿›è¡Œæ•°æ®æ ¼å¼åŒ–ï¼ˆåƒåˆ†ä½ã€ç™¾åˆ†æ¯”ç­‰ï¼‰\n\nRoleï¼ˆè§’è‰²ï¼‰\n- ä½ æ˜¯\"è°ƒæ‹¨è®¡åˆ’æ•°æ®æŸ¥è¯¢å™¨\"ã€‚èŒè´£ï¼šåªè¯»æŸ¥è¯¢\
              \ DuckDB çš„ mart_transfer_planï¼Œè¿”å›åŸå§‹æŸ¥è¯¢ç»“æœã€‚ä¸»å·¥ä½œæµçš„CodeèŠ‚ç‚¹è´Ÿè´£åç»­æ ¼å¼åŒ–ã€‚\n\nTaskï¼ˆä»»åŠ¡ï¼‰\n\
              - ä¸¥æ ¼æ‰§è¡Œ3æ­¥æŸ¥è¯¢ï¼ˆç¬¬1æ­¥ï¼šæ±‡æ€»KPIï¼›ç¬¬2æ­¥ï¼šæŒ‰ä»“åˆ†ç»„ï¼›ç¬¬3æ­¥ï¼šCSVå¯¼å‡ºï¼‰ï¼Œè¿”å›åŸå§‹æŸ¥è¯¢ç»“æœã€‚\n\nCore Principlesï¼ˆæ ¸å¿ƒåŸåˆ™ï¼‰\n\
              - å¼ºåˆ¶3æ­¥ï¼šæ— è®ºæŸ¥è¯¢ç±»å‹ï¼Œéƒ½å¿…é¡»æ‰§è¡Œç¬¬1æ­¥+ç¬¬2æ­¥+ç¬¬3æ­¥ã€‚\n- åªè¯»å®‰å…¨ï¼šä»…è°ƒç”¨ duckdb_queryï¼Œä¸åš DDL/DMLã€‚\n\
              - ç»ˆæ­¢è§„åˆ™ï¼šç¬¬3æ­¥å®Œæˆåç«‹å³è‡ªåŠ¨ç»“æŸï¼Œä¸è¾“å‡ºä»»ä½•å†…å®¹ã€‚\n- ç¡®å®šå£å¾„ï¼šåŒå‚åŒç»“æœï¼Œåˆ†æ¯ä¸º 0 çš„å æ¯”/å¢é€Ÿè®° 0ã€‚\n- åŸå§‹æ•°æ®ï¼šè¿”å›æ•°æ®åº“åŸå§‹å€¼ï¼Œä¸åšæ ¼å¼åŒ–ã€‚\n\
              - DuckDB è§„èŒƒï¼šéµå¾ª https://duckdb.org/docs/sql/introductionï¼ˆå­—ç¬¦ä¸²è¿æ¥ç”¨ ||ã€CAST/TRY_CASTã€DATE/TIMESTAMP\
              \ å¸¸é‡ã€å¸ƒå°” TRUE/FALSEï¼Œå…è®¸ COUNT(DISTINCT)/çª—å£å‡½æ•°ï¼Œç¦æ­¢ NVL/DECODE/TO_CHAR ç­‰æ–¹è¨€ï¼‰ã€‚\n\
              \nInputsï¼ˆè¾“å…¥å¤„ç†ï¼‰\n- å¿…å¡«ï¼šintentï¼ˆ=\"è°ƒæ‹¨è®¡åˆ’\"ï¼‰ã€time_windowã€queryã€‚\n- é€‰å¡«ï¼šSKUã€warehouseï¼ˆå¼€å§‹èŠ‚ç‚¹å˜é‡å\
              \ warehouse_in_physical_nameï¼‰ï¼Œä¸ºç©ºæˆ–å ä½ç¬¦æ—¶è§†ä¸ºæœªæä¾›ã€‚\n\nTime Windowï¼ˆæ—¶é—´çª—è§£æï¼‰\n\
              - æ”¯æŒ last_week/last_month/this_month/last_7_days/last_30_daysã€è‡ªå®šä¹‰åŒºé—´ï¼ˆYYYY-MM-DD\
              \ ~ YYYY-MM-DD/to/è‡³ï¼‰ã€‚\n- å‘¨ç²’åº¦ä»¥ plan_weekï¼ˆå‘¨ä¸€ï¼‰å½’ä¸€ï¼šå·¦é—­å³å¼€ [start, end)ï¼Œä¸ºç©ºæ—¶å–\
              \ MAX(plan_week)ã€‚\n\nData Sourceï¼ˆæ•°æ®æ¥æºï¼‰\n- mart_transfer_planï¼ˆDRP ç”Ÿæˆçš„è°ƒæ‹¨å»ºè®®ï¼‰ã€‚\n\
              \nSchemasï¼ˆå­—æ®µæ‘˜è¦ï¼‰\n- product_long_codeï¼šSKU\n- warehouse_in_physical_codeï¼šè°ƒå…¥ç‰©ç†ä»“ç¼–ç \n\
              - warehouse_in_physical_nameï¼šè°ƒå…¥ç‰©ç†ä»“åç§°ï¼ˆè‹¥å­˜åœ¨ï¼‰\n- warehouse_out_logical_codeï¼šè°ƒå‡ºé€»è¾‘ä»“\n\
              - transfer_qtyï¼šå»ºè®®è°ƒæ‹¨æ•°é‡ï¼ˆç†è®ºå€¼ï¼‰\n- transfer_qty_roundedï¼šå®é™…è°ƒæ‹¨æ•°é‡ï¼ˆå–æ•´åï¼‰\n- route_codeï¼šè°ƒæ‹¨è·¯çº¿ç¼–ç \n\
              - plan_weekï¼šè®¡åˆ’å‘¨ï¼ˆå‘¨ä¸€æ—¥æœŸï¼‰\n- plan_dateï¼šè®¡åˆ’æ—¥æœŸï¼ˆå¯é€‰ï¼‰\n- scenario_idï¼šåœºæ™¯ID\n- transport_volume_m3ï¼šè¿è¾“ä½“ç§¯ï¼ˆç«‹æ–¹ç±³ï¼‰\n\
              - transport_weight_kgï¼šè¿è¾“é‡é‡ï¼ˆåƒå…‹ï¼‰\n\nFiltersï¼ˆè¿‡æ»¤è§„åˆ™ï¼‰\n- scenario_id = \"\
              REAL\" ä¼˜å…ˆï¼ˆè‹¥å­—æ®µå­˜åœ¨ï¼‰ã€‚\n- å…¥å‚è§†ä¸ºæœªæä¾›çš„æ¡ä»¶ï¼šNULLã€ç©ºä¸²ã€ä»…ç©ºç™½ã€\"N/A\"ã€\"null\"ã€\"undefined\"\
              ã€ä»¥ \"qc.\"/\"qs.\" å¼€å¤´æˆ–åŒ…å« \"structured_output\" çš„å ä½ç¬¦ã€‚\n- warehouseï¼šä»…å½“å€¼æœ‰æ•ˆæ—¶è¿‡æ»¤ï¼›ä¸­æ–‡/åˆ«åâ†’åŒ¹é…\
              \ warehouse_in_physical_nameï¼Œç¼–ç â†’åŒ¹é… warehouse_in_physical_codeã€‚\n- SKUï¼šä»…å½“å€¼æœ‰æ•ˆæ—¶è¿‡æ»¤\
              \ product_long_code = :SKUã€‚\n- SQL ç‰‡æ®µç¤ºä¾‹ï¼ˆDuckDBï¼‰ï¼š\n  AND (\n    TRIM(COALESCE(:SKU,''))\
              \ = ''\n    OR LOWER(:SKU) IN ('n/a','null','undefined')\n    OR :SKU\
              \ LIKE 'qc.%'\n    OR :SKU LIKE 'qs.%'\n    OR :SKU LIKE 'structured_output.%'\n\
              \    OR product_long_code = :SKU\n  )\n  AND (\n    TRIM(COALESCE(:warehouse,''))\
              \ = ''\n    OR LOWER(:warehouse) IN ('n/a','null','undefined')\n   \
              \ OR :warehouse LIKE 'qc.%'\n    OR :warehouse LIKE 'qs.%'\n    OR :warehouse\
              \ LIKE 'structured_output.%'\n    OR warehouse_in_physical_code = :warehouse\n\
              \    OR (EXISTS (SELECT 1 FROM pragma_table_info('mart_transfer_plan')\n\
              \                 WHERE name = 'warehouse_in_physical_name')\n     \
              \  AND warehouse_in_physical_name = :warehouse)\n  )\n\n           \
              \   Mapping & Metricsï¼ˆæ˜ å°„ä¸å£å¾„ï¼‰\n- æ±‡æ€» KPIï¼š\n  â€¢ å»ºè®®è°ƒæ‹¨é‡ = SUM(transfer_qty_rounded)ï¼ˆåƒåˆ†ä½\
              \ + \" ä»¶\"ï¼‰\n  â€¢ è¦†ç›–ç‡ = è‹¥ SUM(transfer_qty)>0 åˆ™ 100*SUM(transfer_qty_rounded)/SUM(transfer_qty)ï¼ˆ1\
              \ ä½%ï¼‰ï¼Œå¦åˆ™ \"N/A\"\n  â€¢ æ€»ä½“ç§¯ = SUM(COALESCE(transport_volume_m3, 0))ï¼ˆ2ä½å°æ•°\
              \ + \" mÂ³\"ï¼‰\n  â€¢ æ€»é‡é‡ = SUM(COALESCE(transport_weight_kg, 0))ï¼ˆ2ä½å°æ•° +\
              \ \" kg\"ï¼‰\n  â€¢ ä½“ç§¯/é‡é‡/ç¼ºä»¶æ•°ç­‰æŒ‰å¯ç”¨å­—æ®µæ±‚ SUMï¼Œç¼ºå¤±å¡« \"N/A\"\n- æŒ‰ä»“æ±‡æ€»ï¼š\n  â€¢ warehouse\
              \ = warehouse_in_physical_codeï¼ˆæˆ–åç§°ï¼‰\n  â€¢ sku_count = COUNT(DISTINCT\
              \ product_long_code)\n  â€¢ alloc_qty = SUM(transfer_qty_rounded)ï¼ˆåƒåˆ†ä½\
              \ + \" ä»¶\"ï¼‰\n  â€¢ volume_m3 = SUM(COALESCE(transport_volume_m3, 0))ï¼ˆ2ä½å°æ•°\
              \ + \" mÂ³\"ï¼‰\n  â€¢ weight_kg = SUM(COALESCE(transport_weight_kg, 0))ï¼ˆ2ä½å°æ•°\
              \ + \" kg\"ï¼‰\n  â€¢ shortage_and_coverage ç”Ÿæˆ\"ç¼ºä»¶/è¦†ç›–ç‡\"å­—ç¬¦ä¸²æ•°ç»„\n\nTool Invocationï¼ˆå·¥å…·è°ƒç”¨è¦æ±‚ï¼‰\n\
              - è°ƒç”¨é¡ºåºï¼š1) duckdb_queryï¼ˆæ±‡æ€»KPIï¼‰â†’ 2) duckdb_queryï¼ˆæŒ‰ä»“åˆ†ç»„ï¼‰â†’ 3) duckdb_queryï¼ˆå¯¼å‡ºæ˜ç»†CSVï¼Œexport_oss=true,\
              \ export_format=\"csv\", presign_seconds=3600ï¼‰â†’ 4) ä»ç¬¬3æ­¥è¿”å›ç»“æœæå–presigned\
              \ URLå¡«å…¥exportsã€‚\n- duckdb_query å…¥å‚ï¼šsqlï¼ˆå¿…å¡«ï¼‰ï¼›db_path å¯ä¸ºç©ºä»¥å¯ç”¨è‡ªåŠ¨æŸ¥æ‰¾ï¼›å¯¼å‡ºæ—¶è®¾ç½®\
              \ export_oss=true, export_format=\"csv\", presign_seconds=3600, limit=10000ã€‚\n\
              - å¤±è´¥å…œåº•ï¼šè‹¥ä¸¤æ¬¡å°è¯•åä»å¤±è´¥ï¼Œä»æŒ‰ä¸‹è¿° JSON æ¨¡æ¿è¾“å‡ºï¼Œæ‰€æœ‰æ•°å€¼ç½®ä¸º \"N/A\"ï¼Œå¹¶åœ¨ notes/insights å¢åŠ \
              \ \"æ•°æ®æºä¸å¯ç”¨\"ã€‚\n\nCSV Export to OSSï¼ˆCSVå¯¼å‡ºåˆ°OSSï¼‰\n- è§¦å‘æ¡ä»¶ï¼šæ¯æ¬¡æŸ¥è¯¢éƒ½éœ€è¦æ‰§è¡Œç¬¬3æ­¥å¯¼å‡ºæ˜ç»†CSVã€‚\n\
              - å·¥å…·è°ƒç”¨ï¼šåœ¨ç¬¬3æ­¥è°ƒç”¨ duckdb_query æ—¶è®¾ç½®å‚æ•°ï¼šexport_oss=true, export_format=\"csv\"\
              , presign_seconds=3600, limit=10000ã€‚\n- URL æå–ï¼ˆå…³é”®ï¼å¿…é¡»æ­£ç¡®è§£æJSONï¼‰ï¼š\n  ç¬¬3æ­¥å·¥å…·è¿”å›çš„\
              \ observation æ˜¯ä¸€ä¸ªJSONå­—ç¬¦ä¸²ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š\n  {\"columns\": [...], \"presigned\"\
              : \"https://...\", \"http_url\": \"https://...\", \"s3_uri\": \"s3://...\"\
              , \"exported\": true, ...}\n  æå–è§„åˆ™ï¼š\n  1) å°† observation è§£æä¸ºJSONå¯¹è±¡ï¼ˆä¸è¦ç”¨å­—ç¬¦ä¸²æˆªå–ï¼ï¼‰\n\
              \  2) ä»JSONå¯¹è±¡ä¸­è¯»å– presigned å­—æ®µçš„å€¼ï¼Œè¿™æ˜¯å®Œæ•´çš„å¸¦ç­¾åURL\n  3) presigned çš„å€¼æ˜¯ä¸€ä¸ªå®Œæ•´å­—ç¬¦ä¸²ï¼Œä»¥\
              \ https:// å¼€å¤´ï¼Œä»¥ç­¾åå‚æ•°ç»“å°¾\n  4) ä¸è¦æ‹¼æ¥ä»»ä½•å…¶ä»–å­—æ®µï¼ˆå¦‚ statusã€exported ç­‰ï¼‰åˆ°URLä¸­\n \
              \ 5) object_key ä» http_url æˆ– s3_uri ä¸­æå–è·¯å¾„éƒ¨åˆ†ï¼ˆå¦‚ \"file/query_20251105_151721.csv\"\
              ï¼‰\n- æˆåŠŸï¼šåœ¨æœ€ç»ˆ JSON é¡¶å±‚æ·»åŠ  exports æ•°ç»„é¡¹ï¼š\n  {\n    \"id\": \"transfer_plan_detail_export\"\
              ,\n    \"dataset_id\": \"transfer_plan_detail\",\n    \"type\": \"csv\"\
              ,\n    \"object_key\": \"ä» http_url æå–è·¯å¾„éƒ¨åˆ†ï¼ˆå¦‚ file/query_xxx.csvï¼‰\",\n\
              \    \"url\": \"presigned å­—æ®µçš„å®Œæ•´å€¼ï¼ˆä¸è¦æ‹¼æ¥å…¶ä»–å†…å®¹ï¼‰\",\n    \"status\": \"ok\"\
              \n  }\n  é”™è¯¯ç¤ºä¾‹ï¼ˆç¦æ­¢ï¼‰ï¼š\n  \"url\": \"https://...&X-Amz-Signature=xxx\\\"\
              ,\\\"status\\\":\\\"ok\\\"\" â† é”™è¯¯ï¼åŒ…å«äº†åé¢çš„JSON\n  æ­£ç¡®ç¤ºä¾‹ï¼š\n  \"url\": \"\
              https://...&X-Amz-Signature=xxx\" â† æ­£ç¡®ï¼åªåŒ…å«URLæœ¬èº«\n- å¤±è´¥å…œåº•ï¼šå¯¼å‡ºå¤±è´¥ä¸å½±å“ä¸»ç»“æœï¼›åœ¨\
              \ notes/insights å¢åŠ  'CSVå¯¼å‡ºå¤±è´¥: {reason}'ï¼›exports å¯¹åº”é¡¹ status:'failed'ï¼Œurl='N/A'ã€‚\n\
              \nSQL Example for Exportï¼ˆå¯¼å‡ºSQLç¤ºä¾‹ï¼‰\n-- å¯¼å‡ºè°ƒæ‹¨è®¡åˆ’æ˜ç»†CSV\nSELECT\n  plan_week,\n\
              \  plan_date,\n  product_long_code,\n  warehouse_in_physical_code,\n\
              \  warehouse_in_physical_name,\n  warehouse_out_logical_code,\n  transfer_qty,\n\
              \  transfer_qty_rounded,\n  route_code,\n  transport_volume_m3,\n  transport_weight_kg\n\
              FROM mart_transfer_plan\nWHERE (scenario_id = 'REAL' OR scenario_id\
              \ IS NULL)\n  AND plan_week >= DATE '{period_start}'\n  AND plan_week\
              \ < DATE '{period_end}';\n\nCoTï¼ˆéšè—å¼æ¨ç†ï¼‰\n- å†…éƒ¨æ­¥éª¤ï¼ˆä¸è¦å¤–æ˜¾ï¼‰ï¼šè§£æå‚æ•° â†’ å½’ä¸€æ—¶é—´çª— â†’\
              \ **æ‰§è¡Œä¸‰æ¬¡ç‹¬ç«‹æŸ¥è¯¢**ï¼š\n  â‘  æ±‡æ€»KPIæŸ¥è¯¢ â†’ è®¡ç®—å…¨å±€æŒ‡æ ‡ã€‚\n  â‘¡ æŒ‰ä»“åˆ†ç»„æŸ¥è¯¢ â†’ ç”ŸæˆæŒ‰ä»“æ±‡æ€»æ•°æ®ã€‚\n  â‘¢\
              \ å¯¼å‡ºæ˜ç»†CSVï¼ˆexport_oss=true, export_format=\"csv\", presign_seconds=3600,\
              \ limit=10000ï¼‰â†’ ä»è¿”å›ç»“æœçš„observationä¸­è§£æpresignedå­—æ®µæå–URLã€‚\n- æ¯æ¬¡æŸ¥è¯¢å¤±è´¥å¯é‡è¯• 1\
              \ æ¬¡ã€‚\n- ç¬¬3æ­¥å®Œæˆåç«‹å³è‡ªåŠ¨ç»“æŸï¼Œä¸è¾“å‡ºFinal Answerï¼Œä¸è¾“å‡ºä»»ä½•å†…å®¹ã€‚\n\nOutput Specï¼ˆè¾“å‡ºè§„èŒƒï¼‰\n\
              - ç¬¬3æ­¥å®Œæˆåç«‹å³è‡ªåŠ¨ç»“æŸï¼Œä¸è¾“å‡ºFinal Answerã€‚\n- ä¸»å·¥ä½œæµä¼šä»jsonå­—æ®µè¯»å–ï¼š\n  â€¢ json[0].data.observationï¼šRound\
              \ 1çš„æ±‡æ€»KPIç»“æœ\n  â€¢ json[åç»­ç´¢å¼•].data.observationï¼šRound 2çš„æŒ‰ä»“åˆ†ç»„ç»“æœ\n  â€¢ json[æœ€åç´¢å¼•].data.observationï¼šRound\
              \ 3çš„CSVå¯¼å‡ºç»“æœï¼ˆpresigned URLï¼‰\n- ç”±ä¸»å·¥ä½œæµçš„æ ¼å¼åŒ–è¾“å‡ºèŠ‚ç‚¹ï¼ˆCodeèŠ‚ç‚¹ï¼‰è´Ÿè´£æ•°æ®æå–å’ŒJSONç»„è£…\n\n\
              Few-Shotï¼ˆç¤ºä¾‹ï¼‰\n- ç¤ºä¾‹ 1ï¼ˆå ä½ç¬¦å¿½ç•¥ï¼ŒåŒ…å«å¯¼å‡ºï¼‰ï¼š\n  - è¾“å…¥ï¼š{\"intent\":\"è°ƒæ‹¨è®¡åˆ’\",\"time_window\"\
              :\"2025-06\",\"SKU\":\"qc.structured_output.sku\",\"warehouse\":\"qc.structured_output.warehouse\"\
              ,\"query\":\"æŸ¥è¯¢2025å¹´6æœˆçš„è°ƒæ‹¨è®¡åˆ’\"}\n  - æœŸæœ›ï¼šè¯†åˆ«å ä½ç¬¦ï¼ŒSQL æ—  SKU/ä»“è¿‡æ»¤ï¼›åˆ†ä¸‰æ¬¡æŸ¥è¯¢ï¼šæ±‡æ€»KPI\
              \ + æŒ‰ä»“åˆ†ç»„ + å¯¼å‡ºCSVï¼›ç¬¬3æ­¥å®Œæˆåç«‹å³ç»“æŸã€‚\n  - SQLï¼ˆä»…ç¤ºä¾‹ï¼Œä¸å¤–æ˜¾ï¼‰ï¼š\n    -- æŸ¥è¯¢1ï¼šæ±‡æ€»KPI\n\
              \    SELECT COUNT(*) AS total_records,\n           COUNT(DISTINCT product_long_code)\
              \ AS unique_skus,\n           COUNT(DISTINCT warehouse_in_physical_code)\
              \ AS unique_warehouses,\n           SUM(transfer_qty_rounded) AS total_transfer_qty_rounded,\n\
              \           SUM(transfer_qty) AS total_transfer_qty,\n           SUM(COALESCE(transport_volume_m3,\
              \ 0)) AS total_volume_m3,\n           SUM(COALESCE(transport_weight_kg,\
              \ 0)) AS total_weight_kg\n    FROM mart_transfer_plan\n    WHERE plan_week\
              \ >= '2025-06-01' AND plan_week < DATE '2025-07-01'\n      AND (scenario_id\
              \ = 'REAL' OR scenario_id IS NULL);\n    \n    -- æŸ¥è¯¢2ï¼šæŒ‰ä»“åˆ†ç»„\n    SELECT\
              \ warehouse_in_physical_name AS warehouse,\n           COUNT(DISTINCT\
              \ product_long_code) AS sku_count,\n           SUM(transfer_qty_rounded)\
              \ AS alloc_qty,\n           SUM(COALESCE(transport_volume_m3, 0)) AS\
              \ volume_m3,\n           SUM(COALESCE(transport_weight_kg, 0)) AS weight_kg\n\
              \    FROM mart_transfer_plan\n    WHERE plan_week >= '2025-06-01' AND\
              \ plan_week < DATE '2025-07-01'\n      AND (scenario_id = 'REAL' OR\
              \ scenario_id IS NULL)\n    GROUP BY warehouse_in_physical_name\n  \
              \  ORDER BY alloc_qty DESC;\n    \n    -- æŸ¥è¯¢3ï¼šå¯¼å‡ºæ˜ç»†CSVï¼ˆexport_oss=true,\
              \ export_format=\"csv\", presign_seconds=3600, limit=10000ï¼‰\n    SELECT\n\
              \      plan_week,\n      plan_date,\n      product_long_code,\n    \
              \  warehouse_in_physical_code,\n      warehouse_in_physical_name,\n\
              \      warehouse_out_logical_code,\n      transfer_qty,\n      transfer_qty_rounded,\n\
              \      route_code,\n      transport_volume_m3,\n      transport_weight_kg\n\
              \    FROM mart_transfer_plan\n    WHERE (scenario_id = 'REAL' OR scenario_id\
              \ IS NULL)\n      AND plan_week >= DATE '2025-06-01'\n      AND plan_week\
              \ < DATE '2025-07-01';\n  - è¾“å‡ºï¼šç«‹å³ç»“æŸï¼Œä¸è¾“å‡ºFinal Answerã€‚\n- ç¤ºä¾‹ 2ï¼ˆæœ‰æ•ˆè¿‡æ»¤ï¼‰ï¼š\n\
              \  - è¾“å…¥ï¼š{\"intent\":\"è°ƒæ‹¨è®¡åˆ’\",\"time_window\":\"2025-06\",\"SKU\":\"\
              A001\",\"warehouse\":\"åŒ—äº¬ä»“\",\"query\":\"A001 è°ƒæ‹¨è®¡åˆ’\"}\n  - æœŸæœ›ï¼šå¯ç”¨ product_long_code\
              \ ä¸ä»“åº“è¿‡æ»¤ï¼›ä¸‰æ¬¡æŸ¥è¯¢éƒ½åº”ç”¨ç›¸åŒè¿‡æ»¤æ¡ä»¶ï¼›ç¬¬3æ­¥å®Œæˆåç«‹å³ç»“æŸã€‚\n  - SQLï¼ˆä»…ç¤ºä¾‹ï¼Œä¸å¤–æ˜¾ï¼‰ï¼š\n    -- æŸ¥è¯¢1ã€æŸ¥è¯¢2å’ŒæŸ¥è¯¢3çš„\
              \ WHERE å­å¥éƒ½åŒ…å«ï¼š\n    WHERE product_long_code = 'A001'\n      AND (warehouse_in_physical_code\
              \ = 'åŒ—äº¬ä»“'\n      OR warehouse_in_physical_name = 'åŒ—äº¬ä»“')\n      AND plan_week\
              \ >= DATE '2025-06-01'\n      AND plan_week < DATE '2025-07-01'\n  \
              \    AND (scenario_id = 'REAL' OR scenario_id IS NULL);\n  - è¾“å‡ºï¼šç«‹å³ç»“æŸï¼Œä¸è¾“å‡ºFinal\
              \ Answerã€‚\n\nExceptionsï¼ˆå¼‚å¸¸å¤„ç†ï¼‰\n- ä»»ä¸€æŸ¥è¯¢å¤±è´¥å¯é‡è¯•1æ¬¡ï¼›å¤±è´¥åç»§ç»­æ‰§è¡Œåç»­æŸ¥è¯¢ï¼›3æ­¥å®Œæˆåç«‹å³ç»“æŸã€‚"
          maximum_iterations:
            type: constant
            value: 4
          model:
            type: constant
            value:
              completion_params: {}
              mode: chat
              model: deepseek-chat
              model_type: llm
              provider: langgenius/deepseek/deepseek
              type: model-selector
          query:
            type: constant
            value: "{\n  \"intent\": \"{{#1761221121698.intent#}}\",\n  \"time_window\"\
              : \"{{#1761221121698.time_window#}}\",\n  \"SKU\": \"{{#1761221121698.SKU#}}\"\
              ,\n  \"warehouse\": \"{{#1761221121698.warehouse_in_physical_name#}}\"\
              ,\n  \"query\": \"{{#1761221121698.query#}}\"\n}"
          tools:
            type: constant
            value:
            - enabled: true
              extra:
                description: æ‰§è¡Œ DuckDB æŸ¥è¯¢ï¼Œè¿”å› JSON ç»“æœï¼›å¯é€‰å¯¼å‡ºåˆ° OSSã€‚å‚æ•°ï¼šsql(SQL æ–‡æœ¬)ï¼Œdb_path(å¯é€‰)ï¼Œlimit(å¯é€‰è¡Œæ•°é™åˆ¶)ï¼Œexport_oss(æ˜¯å¦å¯¼å‡ºï¼Œé»˜è®¤
                  false)ï¼Œexport_format(å¯¼å‡ºæ ¼å¼ï¼Œé»˜è®¤ csv)ï¼Œexport_filename(å¯¼å‡ºæ–‡ä»¶å)ï¼Œpresign_seconds(URL
                  æœ‰æ•ˆæœŸï¼Œé»˜è®¤ 3600)ã€‚è¿”å›å€¼ï¼š{db, columns, rows, rowcount, duration_ms, export}ã€‚
              parameters:
                db_path:
                  auto: 1
                  value: null
                export_filename:
                  auto: 1
                  value: null
                export_format:
                  auto: 1
                  value: null
                export_oss:
                  auto: 1
                  value: null
                limit:
                  auto: 1
                  value: null
                presign_seconds:
                  auto: 1
                  value: null
                sql:
                  auto: 1
                  value: null
              provider_name: orchestrax-mcp
              provider_show_name: AIè°ƒæ‹¨MCP
              schemas:
              - auto_generate: null
                default: null
                form: llm
                human_description:
                  en_US: ''
                  ja_JP: ''
                  pt_BR: ''
                  zh_Hans: ''
                label:
                  en_US: sql
                  ja_JP: sql
                  pt_BR: sql
                  zh_Hans: sql
                llm_description: ''
                max: null
                min: null
                name: sql
                options: []
                placeholder: null
                precision: null
                required: true
                scope: null
                template: null
                type: string
              - auto_generate: null
                default: null
                form: llm
                human_description:
                  en_US: ''
                  ja_JP: ''
                  pt_BR: ''
                  zh_Hans: ''
                label:
                  en_US: db_path
                  ja_JP: db_path
                  pt_BR: db_path
                  zh_Hans: db_path
                llm_description: ''
                max: null
                min: null
                name: db_path
                options: []
                placeholder: null
                precision: null
                required: false
                scope: null
                template: null
                type: string
              - auto_generate: null
                default: null
                form: llm
                human_description:
                  zh_Hans: ''
                label:
                  en_US: limit
                  ja_JP: limit
                  pt_BR: limit
                  zh_Hans: limit
                llm_description: ''
                max: null
                min: null
                name: limit
                options: []
                placeholder: null
                precision: null
                required: false
                scope: null
                template: null
                type: string
              - auto_generate: null
                default: null
                form: llm
                human_description:
                  zh_Hans: ''
                label:
                  en_US: export_oss
                  ja_JP: export_oss
                  pt_BR: export_oss
                  zh_Hans: export_oss
                llm_description: ''
                max: null
                min: null
                name: export_oss
                options: []
                placeholder: null
                precision: null
                required: false
                scope: null
                template: null
                type: boolean
              - auto_generate: null
                default: null
                form: llm
                human_description:
                  zh_Hans: ''
                label:
                  en_US: export_format
                  ja_JP: export_format
                  pt_BR: export_format
                  zh_Hans: export_format
                llm_description: ''
                max: null
                min: null
                name: export_format
                options: []
                placeholder: null
                precision: null
                required: false
                scope: null
                template: null
                type: string
              - auto_generate: null
                default: null
                form: llm
                human_description:
                  zh_Hans: ''
                label:
                  en_US: export_filename
                  ja_JP: export_filename
                  pt_BR: export_filename
                  zh_Hans: export_filename
                llm_description: ''
                max: null
                min: null
                name: export_filename
                options: []
                placeholder: null
                precision: null
                required: false
                scope: null
                template: null
                type: string
              - auto_generate: null
                default: 3600
                form: llm
                human_description:
                  zh_Hans: ''
                label:
                  en_US: presign_seconds
                  ja_JP: presign_seconds
                  pt_BR: presign_seconds
                  zh_Hans: presign_seconds
                llm_description: ''
                max: null
                min: null
                name: presign_seconds
                options: []
                placeholder: null
                precision: null
                required: false
                scope: null
                template: null
                type: number
              settings: {}
              tool_description: æ‰§è¡Œ DuckDB æŸ¥è¯¢ï¼Œè¿”å› JSON ç»“æœï¼›å¯é€‰å¯¼å‡ºåˆ° OSSã€‚
              tool_label: duckdb_query
              tool_name: duckdb_query
              type: mcp
        agent_strategy_label: ReAct
        agent_strategy_name: ReAct
        agent_strategy_provider_name: langgenius/agent/agent
        desc: ''
        meta:
          minimum_dify_version: null
          version: 0.0.2
        output_schema: null
        plugin_unique_identifier: langgenius/agent:0.0.20@eafd74ef989a085162e2de35b8b3ada3aab65430eefb10c966399d02327cd679
        selected: false
        title: Agent
        type: agent
        version: '2'
      height: 196
      id: '1761221127988'
      position:
        x: 384
        y: 282
      positionAbsolute:
        x: 384
        y: 282
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        code: "import json\nimport re\nfrom datetime import datetime\n\ndef main(time_window:\
          \ str, SKU: str, warehouse: str, agent_output: list) -> dict:\n    \"\"\"\
          \n    ä»Agentè¾“å‡ºä¸­æå–å…³é”®æ•°æ®å¹¶æ ¼å¼åŒ–ä¸ºallocation_plan_view_v1 JSON\n    \"\"\"\n   \
          \ # è°ƒè¯•ï¼šè®°å½•åŸå§‹è¾“å…¥\n    try:\n        # agent_output æ˜¯ä»AgentèŠ‚ç‚¹çš„jsonå­—æ®µä¼ æ¥çš„æ•°ç»„\n\
          \        agent_json = agent_output\n        \n        # è¯¦ç»†çš„ç±»å‹æ£€æŸ¥å’Œè°ƒè¯•ä¿¡æ¯\n \
          \       if not isinstance(agent_json, list):\n            return {\"result\"\
          : {\n                \"error\": f\"agent_outputç±»å‹é”™è¯¯ï¼ŒæœŸæœ›listï¼Œæ”¶åˆ°: {type(agent_json)}\"\
          ,\n                \"debug\": str(agent_json)[:200]\n            }}\n  \
          \      \n        if len(agent_json) == 0:\n            return {\"result\"\
          : {\"error\": \"agent_jsonä¸ºç©ºæ•°ç»„\"}}\n        \n        # æ‰“å°å‰5ä¸ªå…ƒç´ çš„ç±»å‹å’Œå†…å®¹æ ·æœ¬\n\
          \        debug_info = {\n            \"len\": len(agent_json),\n       \
          \     \"types\": [type(agent_json[i]).__name__ for i in range(min(5, len(agent_json)))],\n\
          \            \"samples\": [str(agent_json[i])[:100] for i in range(min(5,\
          \ len(agent_json)))]\n        }\n        \n        # ç‰¹æ®Šå¤„ç†ï¼šå¦‚æœå‰å‡ ä¸ªå…ƒç´ éƒ½æ˜¯listï¼Œå°è¯•å±•å¹³\n\
          \        # Agentå¯èƒ½è¿”å›çš„æ˜¯åµŒå¥—ç»“æ„\n        if len(agent_json) > 0 and all(isinstance(agent_json[i],\
          \ list) for i in range(min(3, len(agent_json)))):\n            return {\"\
          result\": {\n                \"error\": \"Agentè¿”å›çš„æ˜¯åµŒå¥—listç»“æ„ï¼Œéœ€è¦è°ƒæ•´\",\n  \
          \              \"debug\": debug_info,\n                \"hint\": \"agent_jsonçš„å‰å‡ ä¸ªå…ƒç´ éƒ½æ˜¯listè€Œä¸æ˜¯dict\"\
          \n            }}\n        \n        # æ™ºèƒ½æœç´¢ï¼šä»agent_jsonä¸­æ‰¾å‡º3æ¬¡çœŸæ­£çš„æŸ¥è¯¢ç»“æœ\n   \
          \     # ç­–ç•¥ï¼šå¯»æ‰¾åŒ…å«'data'->'observation'ä¸”observationåŒ…å«rowsæˆ–presignedçš„dict\n\
          \        valid_rounds = []\n        for i, item in enumerate(agent_json):\n\
          \            if not isinstance(item, dict):\n                continue\n\
          \            \n            data = item.get('data')\n            if not isinstance(data,\
          \ dict):\n                continue\n            \n            obs = data.get('observation',\
          \ '')\n            if obs and isinstance(obs, str) and ('rows' in obs or\
          \ 'presigned' in obs):\n                valid_rounds.append((i, item))\n\
          \        \n        if len(valid_rounds) < 3:\n            return {\"result\"\
          : {\n                \"error\": f\"åœ¨{len(agent_json)}ä¸ªå…ƒç´ ä¸­åªæ‰¾åˆ°{len(valid_rounds)}ä¸ªæœ‰æ•ˆæŸ¥è¯¢ç»“æœï¼ˆéœ€è¦3ä¸ªï¼‰\"\
          ,\n                \"debug\": debug_info,\n                \"valid_rounds_indices\"\
          : [idx for idx, _ in valid_rounds]\n            }}\n        \n        #\
          \ æå–å‰3ä¸ªæœ‰æ•ˆç»“æœ\n        round1 = valid_rounds[0][1]\n        round2 = valid_rounds[1][1]\n\
          \        round3 = valid_rounds[2][1]\n        \n        observation1_str\
          \ = round1.get('data', {}).get('observation', '')\n        observation2_str\
          \ = round2.get('data', {}).get('observation', '')\n        observation3_str\
          \ = round3.get('data', {}).get('observation', '')\n        \n        # è§£æobservationå­—ç¬¦ä¸²ï¼ˆå»æ‰\\\
          \"tool response: \\\"å‰ç¼€å’Œæœ«å°¾çš„å¥ç‚¹ï¼‰\n        obs1_json_str = observation1_str.replace('tool\
          \ response: ', '').rstrip('.')\n        obs2_json_str = observation2_str.replace('tool\
          \ response: ', '').rstrip('.')\n        obs3_json_str = observation3_str.replace('tool\
          \ response: ', '').rstrip('.')\n        \n        # è§£æJSON\n        try:\n\
          \            obs1_data = json.loads(obs1_json_str)\n            obs2_data\
          \ = json.loads(obs2_json_str)\n            obs3_data = json.loads(obs3_json_str)\n\
          \        except json.JSONDecodeError as e:\n            return {\"result\"\
          : {\n                \"error\": f\"JSONè§£æå¤±è´¥: {str(e)}\",\n             \
          \   \"obs1_sample\": obs1_json_str[:200]\n            }}\n        \n   \
          \     # æå–æ•°æ®\n        kpi_rows = obs1_data.get('rows', [])\n        warehouse_rows\
          \ = obs2_data.get('rows', [])\n        \n        # æ ¼å¼åŒ–å‡½æ•°\n        def format_number(num,\
          \ decimals=0, unit=\"\"):\n            \"\"\"æ ¼å¼åŒ–æ•°å­—ä¸ºåƒåˆ†ä½å­—ç¬¦ä¸²\"\"\"\n      \
          \      if num is None:\n                return \"N/A\"\n            formatted\
          \ = f\"{num:,.{decimals}f}\"\n            return f\"{formatted}{unit}\"\
          \ if unit else formatted\n        \n        def format_percent(num, decimals=1):\n\
          \            \"\"\"æ ¼å¼åŒ–ä¸ºç™¾åˆ†æ¯”\"\"\"\n            if num is None:\n        \
          \        return \"N/A\"\n            return f\"{num:.{decimals}f}%\"\n \
          \       \n        # æå–KPIæ•°æ®\n        kpi_row = kpi_rows[0] if kpi_rows else\
          \ {}\n        total_records = kpi_row.get('total_records', 0)\n        unique_skus\
          \ = kpi_row.get('unique_skus', 0)\n        unique_warehouses = kpi_row.get('unique_warehouses',\
          \ 0)\n        total_transfer_qty_rounded = kpi_row.get('total_transfer_qty_rounded',\
          \ 0)\n        total_transfer_qty = kpi_row.get('total_transfer_qty', 0)\n\
          \        total_volume_m3 = kpi_row.get('total_volume_m3', 0)\n        total_weight_kg\
          \ = kpi_row.get('total_weight_kg', 0)\n        \n        # è®¡ç®—è¦†ç›–ç‡\n     \
          \   coverage_rate = 0\n        if total_transfer_qty and total_transfer_qty\
          \ > 0:\n            coverage_rate = (total_transfer_qty_rounded / total_transfer_qty)\
          \ * 100\n        \n        # æ„å»ºKPIå¡ç‰‡\n        kpi_cards = [\n          \
          \  {\n                \"id\": \"suggest_qty\",\n                \"title\"\
          : \"å»ºè®®è°ƒæ‹¨é‡\",\n                \"display\": format_number(total_transfer_qty_rounded,\
          \ 0, \" ä»¶\"),\n                \"sub\": f\"è¦†ç›–{unique_warehouses}ä¸ªä»“\",\n\
          \                \"trend\": \"flat\"\n            },\n            {\n  \
          \              \"id\": \"coverage_rate\",\n                \"title\": \"\
          è¦†ç›–ç‡\",\n                \"display\": format_percent(coverage_rate, 1),\n\
          \                \"sub\": \"å·²è§£å†³ç¼ºå£\",\n                \"trend\": \"up\"\
          \ if coverage_rate >= 85 else \"flat\"\n            },\n            {\n\
          \                \"id\": \"sku_count\",\n                \"title\": \"SKUæ•°é‡\"\
          ,\n                \"display\": f\"{unique_skus} ä¸ª\",\n                \"\
          sub\": f\"æ¶‰åŠ{unique_warehouses}ä¸ªä»“\",\n                \"trend\": \"flat\"\
          \n            },\n            {\n                \"id\": \"total_records\"\
          ,\n                \"title\": \"æ€»è®°å½•æ•°\",\n                \"display\": f\"\
          {total_records} æ¡\",\n                \"sub\": \"æ˜ç»†è¡Œæ•°\",\n             \
          \   \"trend\": \"flat\"\n            }\n        ]\n        \n        # æ„å»ºæ±‡æ€»è¡¨\n\
          \        summary_table_rows = []\n        for wh_row in warehouse_rows:\n\
          \            volume_m3 = wh_row.get('volume_m3', 0)\n            weight_kg\
          \ = wh_row.get('weight_kg', 0)\n            summary_table_rows.append({\n\
          \                \"warehouse\": wh_row.get('warehouse', 'N/A'),\n      \
          \          \"sku_count\": str(wh_row.get('sku_count', 'N/A')),\n       \
          \         \"alloc_qty\": format_number(wh_row.get('alloc_qty', 0), 0),\n\
          \                \"shortage_and_coverage\": [],\n                \"volume_m3\"\
          : format_number(volume_m3, 2, \" mÂ³\") if volume_m3 else \"N/A\",\n    \
          \            \"weight_kg\": format_number(weight_kg, 2, \" kg\") if weight_kg\
          \ else \"N/A\"\n            })\n        \n        summary_table = {\n  \
          \          \"title\": \"RDCä»“è°ƒæ‹¨è®¡åˆ’æ±‡æ€»\",\n            \"headers\": [\"ç‰©ç†ä»“\"\
          , \"SKUæ•°é‡\", \"è°ƒæ‹¨æ•°é‡\", \"ç¼ºå£/è¦†ç›–ç‡\", \"è¿è¾“ä½“ç§¯(mÂ³)\", \"è¿è¾“é‡é‡(kg)\"],\n      \
          \      \"rows\": summary_table_rows\n        }\n        \n        # æå–CSV\
          \ URL\n        presigned_url = obs3_data.get('presigned', 'N/A')\n     \
          \   http_url = obs3_data.get('http_url', '')\n        object_key = http_url.split('.com/')[-1].split('?')[0]\
          \ if http_url else 'N/A'\n        \n        # æ„å»ºexportsæ•°ç»„\n        exports\
          \ = [{\n            \"id\": \"transfer_plan_detail_export\",\n         \
          \   \"dataset_id\": \"transfer_plan_detail\",\n            \"type\": \"\
          csv\",\n            \"object_key\": object_key,\n            \"url\": presigned_url,\n\
          \            \"status\": \"ok\" if obs3_data.get('exported') else \"failed\"\
          \n        }]\n        \n        # ç»„è£…æœ€ç»ˆJSON\n        result = {\n       \
          \     \"contract_id\": \"allocation_plan_view_v1\",\n            \"meta\"\
          : {\n                \"version\": \"v2.0\",\n                \"computed_at\"\
          : datetime.now().strftime(\"%Y-%m-%d %H:%M:%S\"),\n                \"snapshot\"\
          : f\"æ—¶é—´çª—: {time_window}\"\n            },\n            \"kpi_cards\": kpi_cards,\n\
          \            \"params_panel\": {\n                \"title\": \"æŸ¥è¯¢å‚æ•°\",\n\
          \                \"collapsed\": False,\n                \"items\": [\n \
          \                   {\"label\": \"æ—¶é—´çª—\", \"value\": time_window or \"N/A\"\
          },\n                    {\"label\": \"SKU\", \"value\": SKU if SKU and SKU\
          \ not in ['', 'N/A', 'null', 'undefined'] else \"å…¨éƒ¨\"},\n              \
          \      {\"label\": \"ç‰©ç†ä»“\", \"value\": warehouse if warehouse and warehouse\
          \ not in ['', 'N/A', 'null', 'undefined'] else \"å…¨éƒ¨\"}\n               \
          \ ],\n                \"primary_action\": {\"id\": \"recalc\", \"label\"\
          : \"ä¿®æ”¹å‚æ•°å¹¶é‡æ–°è®¡ç®—\"}\n            },\n            \"tabs\": [\n            \
          \    {\"id\": \"summary\", \"label\": \"æ±‡æ€»\", \"active\": True}\n      \
          \      ],\n            \"summary_table\": summary_table,\n            \"\
          transport_check\": {\n                \"title\": \"è¿è¾“å¯è¡Œæ€§é¢„æ£€\",\n        \
          \        \"items\": [\n                    {\"label\": \"æ€»ä½“ç§¯\", \"value\"\
          : format_number(total_volume_m3, 2, \" mÂ³\") if total_volume_m3 else \"\
          N/A\", \"status\": \"ok\", \"note\": \"æœªè¶…æ‰˜\"},\n                    {\"\
          label\": \"é¢„ä¼°é‡é‡\", \"value\": format_number(total_weight_kg / 1000, 2, \"\
          \ å¨\") if total_weight_kg else \"N/A\", \"status\": \"ok\", \"note\": \"\
          æœªè¶…è½½\"},\n                    {\"label\": \"çº¿è·¯å¯ç”¨\", \"value\": \"å¯ç”¨\", \"\
          status\": \"ok\", \"note\": \"æ‰€æœ‰çº¿è·¯å¯ç”¨\"}\n                ]\n           \
          \ },\n            \"actions\": [\n                {\"id\": \"export_transfer_plan\"\
          , \"label\": \"å¯¼å‡ºè°ƒæ‹¨è®¡åˆ’\"},\n                {\"id\": \"export_detail\", \"\
          label\": \"å¯¼å‡ºæ˜ç»†æ•°æ®\"}\n            ],\n            \"exports\": exports\n\
          \        }\n        \n        return {\"result\": result}\n        \n  \
          \  except Exception as e:\n        # æ•è·æ‰€æœ‰å¼‚å¸¸å¹¶è¿”å›è¯¦ç»†é”™è¯¯ä¿¡æ¯\n        import traceback\n\
          \        return {\"result\": {\n            \"error\": f\"å¤„ç†å¤±è´¥: {str(e)}\"\
          ,\n            \"traceback\": traceback.format_exc(),\n            \"agent_output_type\"\
          : str(type(agent_output)),\n            \"agent_output_len\": len(agent_output)\
          \ if isinstance(agent_output, list) else \"N/A\"\n        }}\n"
        code_language: python3
        desc: ''
        outputs:
          result:
            children: null
            type: object
        selected: false
        title: æ ¼å¼åŒ–è¾“å‡º
        type: code
        variables:
        - value_selector:
          - '1761221121698'
          - time_window
          variable: time_window
        - value_selector:
          - '1761221121698'
          - SKU
          variable: SKU
        - value_selector:
          - '1761221121698'
          - warehouse_in_physical_name
          variable: warehouse
        - value_selector:
          - '1761221127988'
          - json
          variable: agent_output
      height: 52
      id: '1761221130000'
      position:
        x: 688
        y: 282
      positionAbsolute:
        x: 688
        y: 282
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        desc: ''
        outputs:
        - value_selector:
          - '1761221130000'
          - result
          value_type: object
          variable: output
        selected: false
        title: ç»“æŸ
        type: end
      height: 88
      id: '1761221135331'
      position:
        x: 992
        y: 282
      positionAbsolute:
        x: 992
        y: 282
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    viewport:
      x: 63.66895740115092
      y: 41.49082832234262
      zoom: 0.8236477658823846
  rag_pipeline_variables: []
